{% set name = "omnipkg" %}
{% set version = "2.0.2" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: 4a34f802b830012b681c2f1708ce571cc1a4505dcc2e40f2c06254e8c45b7d94

build:
  number: 0
  noarch: python
  script: "python -m pip install . --no-deps --no-build-isolation -vv"
  entry_points:
    - omnipkg = omnipkg.cli:main
    - 8pkg = omnipkg.cli:main
    - 8PKG = omnipkg.cli:main
    - OMNIPKG = omnipkg.cli:main

requirements:
  host:
    - python >=3.7,<3.15
    - pip
    - setuptools >=61.0
  run:
    - python >=3.7,<3.15
    - packaging >=23.0  # [py>=310]
    - packaging >=21.0,<22.0  # [py<310]
    - requests >=2.20
    - authlib >=1.6.5
    - filelock >=3.9
    - psutil >=5.9.0
    - tomli  # [py<311]
    - safety >=3.0  # [py>=310 and py<314]
    - aiohttp >=3.13.1
    - pip-audit >=2.6.0  # [py>=314]
    - uv >=0.9.5

test:
  imports:
    - omnipkg
  commands:
    - omnipkg --version

about:
  home: https://github.com/1minds3t/omnipkg
  license: AGPL-3.0-only
  license_family: AGPL
  license_file: LICENSE
  summary: 'A distributed runtime hypervisor for Python enabling concurrent, zero-copy multi-framework orchestration.'
  description: |
    OmniPkg v2.0.1 is a significant stability and performance release that transforms it
    into a local Hypervisor for Python. It allows conflicting AI frameworks and hardware
    drivers to run concurrently in the same workflow with near-zero latency.

    This release focuses on three key areas:

    1. Performance Overhaul: Microsecond Activation
       The loader has been obsessively profiled and optimized. Pre-flight checks for
       existing packages now complete in ~50 microseconds (a ~500x speedup) via
       direct filesystem scans. Knowledge Base updates are now surgical, avoiding
       slow full-filesystem scans after installations.

    2. Critical Stability & Cross-Platform Fixes:
       Resolves multiple recursion loops during first-time setup, especially on Windows.
       Full daemon functionality is now enabled on Windows via a --no-fork mode. Bugs
       related to psutil detection, initial KB creation, and binary PATH manipulation
       have been fixed, ensuring a robust user experience from the very first run.

    3. Architectural Enhancements:
       The daemon architecture was hardened with more granular locking to allow safe,
       concurrent worker spawning. This release also introduces a smart verification
       system for interdependent packages, automatic detection of special package
       indexes (like PyTorch CUDA variants), and snapshot-based environment restoration.

  doc_url: https://omnipkg.readthedocs.io/en/latest/
  dev_url: https://github.com/1minds3t

extra:
  recipe-maintainers:
    - 1minds3t
